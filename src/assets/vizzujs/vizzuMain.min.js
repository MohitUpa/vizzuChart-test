class Render{init(e,t,r){this.polygonFirstPoint=!1,this.offscreenCanvas=document.createElement("CANVAS"),this.offscreenContext=this.offscreenCanvas.getContext("2d"),this.update=e,this.mainCanvas=t,this.mainCanvas.font="Roboto Condensed",this.mainCanvas.textAlign="left",this.mainCanvas.textBaseline="top",this.context=t.getContext("2d"),this.log=r,this.updateCanvasSize(),this.prevUpdateHash=""}canvas(){return this.mainCanvas}dc(){return this.offscreenContext}clientRect(){return this.mainCanvas.getBoundingClientRect()}frameBegin(){this.currentLineWidth=1,this.offscreenContext.clearRect(0,0,this.mainCanvas.width,this.mainCanvas.height)}frameEnd(){this.context.clearRect(0,0,this.mainCanvas.width,this.mainCanvas.height),this.context.drawImage(this.offscreenCanvas,0,0)}lineWidthNotification(e){this.currentLineWidth=e}noneZeroLineWidth(){return 0!==this.currentLineWidth}startPolygonNotification(){var e=this.polygonFirstPoint;return this.polygonFirstPoint=!0,!e}endPolygonNotification(){this.polygonFirstPoint=!1}updateCanvasSize(){this.scaleFactor=window.devicePixelRatio,this.cssWidth=+getComputedStyle(this.mainCanvas).width.slice(0,-2),this.cssHeight=+getComputedStyle(this.mainCanvas).height.slice(0,-2);var e=`${this.scaleFactor}:${this.cssWidth}:`+this.cssHeight;e!==this.prevUpdateHash&&(this.mainCanvas.width=this.cssWidth*this.scaleFactor,this.mainCanvas.height=this.cssHeight*this.scaleFactor,this.offscreenCanvas.width=this.cssWidth*this.scaleFactor,this.offscreenCanvas.height=this.cssHeight*this.scaleFactor,this.offscreenContext.translate(.5,.5),this.offscreenContext.scale(this.scaleFactor,this.scaleFactor)),this.prevUpdateHash=e}updateFrame(e){var t=performance.now(),e=(this.updateCanvasSize(),0<this.mainCanvas.width&&0<this.mainCanvas.height&&this.update(this.scaleFactor,this.cssWidth,this.cssHeight,e),performance.now()-t);this.log&&1<e&&console.log("Render.updateFrame: "+e.toFixed(2)+"ms")}}class Events{constructor(e){this.vizzu=e,this.module=e.module,this.eventHandlers=new Map}add(e,t){if(e!==""+e)throw new Error("first parameter should be string");e=this.vizzu.toCString(e);try{var r=this.vizzu.call(this.module._addEventListener)(e);this.eventHandlers.set(r,t)}finally{this.module._free(e)}}remove(e,n){var t=this.vizzu.toCString(e);if(e!==""+e)throw new Error("first parameter should be string");try{if(n){let r=null;if(this.eventHandlers.forEach((e,t)=>{e===n&&(r=t)}),null===r)throw new Error("unknown event handler");this.vizzu.call(this.module._removeEventListener)(t,r)}else this.vizzu.call(this.module._removeEventListener)(t,0)}finally{this.eventHandlers.delete(n),this.module._free(t)}}invoke(t,r){try{if(this.eventHandlers.has(t)){let e=JSON.parse(this.vizzu.fromCString(r));e.preventDefault=()=>{this.vizzu.call(this.module._event_preventDefault)()},e.event.endsWith("-draw")&&(e.renderingContext=this.vizzu.render.dc()),this.eventHandlers.get(t)(e)}}catch(e){console.log("exception in event handler: "+e)}}}const assert=(e,t)=>{if(!e)throw new Error("Assert failed: "+t)},assertArray=(t,e,r)=>{assert(Array.isArray(e),"array is not a list");try{if(e.length!==t.dimensions[r].values.length)throw new Error("Assert failed")}catch(e){assert(!1,"dimensions are not the same")}e.forEach(e=>{Array.isArray(e)&&assertArray(t,e,r-1)})};class UnPivot{static isPivot(e){return void 0!==e?.dimensions||void 0!==e?.measures}static convert(i){assert("object"==typeof i&&null!==i&&!Array.isArray(i),"data is not an object"),assert("dimensions"in i,"data.dimensions is requreid"),assert("measures"in i,"data.measures is requreid"),i.series=[];let a=1;assert(Array.isArray(i.dimensions),"data.dimensions is not a list");for(let e=0;e<i.dimensions.length;e++){var t=i.dimensions[e];assert("object"==typeof t&&null!==t&&!Array.isArray(t),"data.dimensions.item is not an object"),assert("name"in t,"data.dimensions.item.name is requreid"),assert(void 0===t.type||"dimension"===t.type,"data.dimensions.item.type is invalid"),assert("values"in t,"data.dimensions.item.values is requreid"),assert(Array.isArray(t.values),"data.dimensions.item.values is not a list"),assert(0!==t.values.length,"data.dimensions.item.values length is zero"),a*=t.values.length}let s=1;for(let n=0;n<i.dimensions.length;n++){let e=i.dimensions[n],t=[],r=[];e.values.forEach(t=>{for(let e=1;e<=s;e++)r.push(t)}),s*=e.values.length;for(let e=1;e<=a/s;e++)t=t.concat(r);var o={name:e.name,type:e.type||"dimension",values:t};i.series.push(o)}assert("object"==typeof i.measures&&null!==i.measures,"data.measures is not a list or an object"),Array.isArray(i.measures)||(i.measures=[i.measures]);for(let r=0;r<i.measures.length;r++){let e=i.measures[r],t=(assert("object"==typeof e&&null!==e&&!Array.isArray(e),"data.measures.item is not an object"),assert("name"in e,"data.measures.item.name is requreid"),assert("values"in e,"data.measures.item.values is requreid"),assert(Array.isArray(e.values),"data.measures.item.values is not a list"),assertArray(i,e.values,i.dimensions.length-1),{name:e.name,type:e.type,values:e.values.flat(1/0)});void 0===t.type&&delete t.type,assert(t.values.length===a,"dimensions are not the same"),i.series.push(t)}}}class DataRecord{constructor(e,t){return this.chart=e,this.record=t,new Proxy(this,{get:(e,t)=>e.getValue(t)})}getValue(e){e=this.chart.toCString(e);let t,r;try{t=this.chart.call(this.chart.module._record_getValue)(this.record,e,!0),r=t?this.chart.fromCString(t):(t=this.chart.call(this.chart.module._record_getValue)(this.record,e,!1),this.chart.module.getValue(t,"double"))}finally{this.chart.module._free(e)}return r}}class Data{constructor(e){this.chart=e}set(e){if(e){if(UnPivot.isPivot(e)){if(this.is1NF(e))throw new Error("inconsistent data form: series/records and dimensions/measures are both set.");UnPivot.convert(e)}if(e.series){if(!Array.isArray(e.series))throw new Error("data series field is not an array");for(const t of e.series)this.setSeries(t)}if(e.records){if(!Array.isArray(e.records))throw new Error("data records field is not an array");for(const r of e.records)this.addRecord(r)}!e.filter&&null!==e.filter||this.setFilter(e.filter)}}addRecord(t){if(!Array.isArray(t))throw new Error("data record is not an array");let r=new Uint32Array(t.length);for(let e=0;e<t.length;e++){var n=this.chart.toCString(String(t[e]).toString());r[e]=n}var e=4*t.length,i=this.chart.module._malloc(e);new Uint8Array(this.chart.module.HEAPU8.buffer,i,e).set(new Uint8Array(r.buffer));try{this.chart.call(this.chart.module._data_addRecord)(i,t.length)}finally{for(var a of r)this.chart.module._free(a);this.chart.module._free(i)}}setSeries(e){if(!e.name)throw new Error("missing series name");if(e.values||(e.values=[]),e.type||(e.type=this.detectType(e.values)),"dimension"===e.type)this.addDimension(e.name,e.values);else{if("measure"!==e.type)throw new Error("invalid series type: "+e.type);this.addMeasure(e.name,e.values)}}detectType(e){if(Array.isArray(e)&&e.length){if("number"==typeof e[0])return"measure";if(e[0]===""+e[0])return"dimension"}return null}addDimension(e,t){if("string"!=typeof e&&!(e instanceof String))throw new Error("first parameter should be string");if(!(t instanceof Array))throw new Error("second parameter should be an array");let r=new Uint32Array(t.length);for(let e=0;e<t.length;e++){if("string"!=typeof t[e]&&!(t[e]instanceof String))throw new Error("array element should be string");var n=this.chart.toCString(t[e]);r[e]=n}var i=4*t.length,a=this.chart.module._malloc(i),i=(new Uint8Array(this.chart.module.HEAPU8.buffer,a,i).set(new Uint8Array(r.buffer)),this.chart.toCString(e));try{this.chart.call(this.chart.module._data_addDimension)(i,a,t.length)}finally{this.chart.module._free(i);for(var s of r)this.chart.module._free(s);this.chart.module._free(a)}}addMeasure(e,t){if("string"!=typeof e&&!(e instanceof String))throw new Error("first parameter should be string");if(!(t instanceof Array))throw new Error("second parameter should be an array");var r=new Float64Array(t),n=8*t.length,i=this.chart.module._malloc(n),n=(new Uint8Array(this.chart.module.HEAPU8.buffer,i,n).set(new Uint8Array(r.buffer)),this.chart.toCString(e));try{this.chart.call(this.chart.module._data_addMeasure)(n,i,t.length)}finally{this.chart.module._free(n),this.chart.module._free(i)}}setFilter(t){if("function"==typeof t){var e=this.chart.module.addFunction(e=>t(new DataRecord(this.chart,e)),"ii");this.chart.call(this.chart.module._chart_setFilter)(e)}else{if(null!==t)throw new Error("data filter is not a function or null");this.chart.call(this.chart.module._chart_setFilter)(0)}}is1NF(e){return e.series||e.records}}class AnimControl extends Promise{constructor(r,e){super((e,t)=>{r(e,t)}),this.chart=e}then(e,t){const r=super.then(e,t);return r.chart=this.chart,r}get[Symbol.toStringTag](){return"AnimControl"}seek(e){return this.animControl("seek",e),this}pause(){return this.animControl("pause"),this}play(){return this.animControl("play"),this}stop(){return this.animControl("stop"),this}reverse(){return this.animControl("reverse"),this}animControl(e,t=""){e=this.chart.toCString(e),t=this.chart.toCString(t);try{this.chart.call(this.chart.module._anim_control)(e,t)}finally{this.chart.module._free(t),this.chart.module._free(e)}}}class Tooltip{constructor(e){this.set=!1,this.chart=e,this.id=0,this.animating=!1,this.lastMarkerId=null,this.lastMove=new Date,this.mouseMoveHandler=e=>{this.mousemove(e)},this.mouseOnHandler=e=>{this.mouseon(e)},this.enabled=!1}enable(e){e!==this.set&&(e?(this.chart.on("mousemove",this.mouseMoveHandler),this.chart.on("mouseon",this.mouseOnHandler)):(this.chart.off("mousemove",this.mouseMoveHandler),this.chart.off("mouseon",this.mouseOnHandler),this.id++,setTimeout(()=>{this.out(this.id)},200)),this.set=e)}mousemove(){this.lastMove=new Date}mouseon(e){this.id++;let t=this.id;e.data.marker?setTimeout(()=>{this.in(t,e.data.marker.id)},0):setTimeout(()=>{this.out(t)},200)}in(e,t){this.id===e&&(this.animating?setTimeout(()=>{this.in(e,t)},100):(this.lastMarkerId=t,this.animating=!0,this.chart.animate({config:{tooltip:t}},this.lastMarkerId?"100ms":"250ms").then(()=>{this.animating=!1})))}out(e){var t;this.id===e&&(t=new Date-this.lastMove,!this.animating&&200<t?(this.lastMarkerId=null,this.animating=!0,this.chart.animate({config:{tooltip:null}},"250ms").then(()=>{this.animating=!1})):setTimeout(()=>{this.out(e)},200-t))}}var VizzuModule=function(){var ke=import.meta.url;return function(t){var r,n,e,l=void 0!==(t=t||{})?t:{},o=(l.ready=new Promise(function(e,t){r=e,n=t}),{});for(e in l)l.hasOwnProperty(e)&&(o[e]=l[e]);var u,v="";document.currentScript&&(v=document.currentScript.src);var v=0!==(v=ke?ke:v).indexOf("blob:")?v.substr(0,v.lastIndexOf("/")+1):"",p=console.log.bind(console),y=console.warn.bind(console);for(e in o)o.hasOwnProperty(e)&&(l[e]=o[e]);var g,_,w,o=null,b=[];function A(t,r){var n,i=S;if(!g){g=new WeakMap;for(var e=0;e<i.length;e++){var a=i.get(e);a&&g.set(a,e)}}if(g.has(t))return g.get(t);if(b.length)n=b.pop();else{n=i.length;try{i.grow(1)}catch(e){if(!(e instanceof RangeError))throw e;throw"Unable to grow wasm table. Set ALLOW_TABLE_GROWTH."}}try{i.set(n,t)}catch(e){if(!(e instanceof TypeError))throw e;r=function(e,t){if("function"==typeof WebAssembly.Function){for(var r={i:"i32",j:"i64",f:"f32",d:"f64"},n={parameters:[],results:"v"==t[0]?[]:[r[t[0]]]},i=1;i<t.length;++i)n.parameters.push(r[t[i]]);return new WebAssembly.Function(n,e)}var a=[1,0,1,96],s=t.slice(0,1),o=t.slice(1),u={i:127,j:126,f:125,d:124};for(a.push(o.length),i=0;i<o.length;++i)a.push(u[o[i]]);return"v"==s?a.push(0):a=a.concat([1,u[s]]),a[1]=a.length-2,s=new Uint8Array([0,97,115,109,1,0,0,0].concat(a,[2,7,1,1,101,1,102,0,0,7,5,1,1,102,0,0])),s=new WebAssembly.Module(s),new WebAssembly.Instance(s,{e:{f:e}}).exports.f}(t,r);i.set(n,r)}return g.set(t,n),n}function C(e,t,r,n){switch(r="*"===(r=r||"i8").charAt(r.length-1)?"i32":r){case"i1":case"i8":H[e>>0]=t;break;case"i16":d[e>>1]=t;break;case"i32":f[e>>2]=t;break;case"i64":i=[t>>>0,1<=+$(i=t)?0<i?(0|X(+K(i/4294967296),4294967295))>>>0:~~+G((i-(~~i>>>0))/4294967296)>>>0:0],f[e>>2]=i[0],f[e+4>>2]=i[1];break;case"float":D[e>>2]=t;break;case"double":R[e>>3]=t;break;default:ee("invalid type for setValue: "+r)}}function z(e,t,r){switch(t="*"===(t=t||"i8").charAt(t.length-1)?"i32":t){case"i1":case"i8":return H[e>>0];case"i16":return d[e>>1];case"i32":case"i64":return f[e>>2];case"float":return D[e>>2];case"double":return R[e>>3];default:ee("invalid type for getValue: "+t)}return null}"object"!=typeof WebAssembly&&ee("no native wasm support detected");var S=new WebAssembly.Table({initial:1162,element:"anyfunc"}),E=!1,P="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function T(e,t,r){for(var n=t+r,i=t;e[i]&&!(n<=i);)++i;if(16<i-t&&e.subarray&&P)return P.decode(e.subarray(t,i));for(var a="";t<i;){var s,o,u=e[t++];128&u?(s=63&e[t++],192!=(224&u)?(o=63&e[t++],(u=224==(240&u)?(15&u)<<12|s<<6|o:(7&u)<<18|s<<12|o<<6|63&e[t++])<65536?a+=String.fromCharCode(u):(o=u-65536,a+=String.fromCharCode(55296|o>>10,56320|1023&o))):a+=String.fromCharCode((31&u)<<6|s)):a+=String.fromCharCode(u)}return a}function c(e,t){return e?T(h,e,t):""}function F(e,t,r){var n=e,i=h,a=t,e=r;if(!(0<e))return 0;for(var t=a,s=a+e-1,o=0;o<n.length;++o){var u=n.charCodeAt(o);if((u=55296<=u&&u<=57343?65536+((1023&u)<<10)|1023&n.charCodeAt(++o):u)<=127){if(s<=a)break;i[a++]=u}else if(u<=2047){if(s<=a+1)break;i[a++]=192|u>>6,i[a++]=128|63&u}else if(u<=65535){if(s<=a+2)break;i[a++]=224|u>>12,i[a++]=128|u>>6&63,i[a++]=128|63&u}else{if(s<=a+3)break;i[a++]=240|u>>18,i[a++]=128|u>>12&63,i[a++]=128|u>>6&63,i[a++]=128|63&u}}return i[a]=0,a-t}var k="undefined"!=typeof TextDecoder?new TextDecoder("utf-16le"):void 0;function W(e,t){for(var r,n=e>>1,i=n+t/2;!(i<=n)&&j[n];)++n;if(32<(r=n<<1)-e&&k)return k.decode(h.subarray(e,r));for(var a=0,s="";;){var o=d[e+2*a>>1];if(0==o||a==t/2)return s;++a,s+=String.fromCharCode(o)}}function O(e,t,r){if((r=void 0===r?2147483647:r)<2)return 0;for(var n=t,i=(r-=2)<2*e.length?r/2:e.length,a=0;a<i;++a){var s=e.charCodeAt(a);d[t>>1]=s,t+=2}return d[t>>1]=0,t-n}function U(e){return 2*e.length}function V(e,t){for(var r=0,n="";!(t/4<=r);){var i,a=f[e+4*r>>2];if(0==a)break;++r,65536<=a?(i=a-65536,n+=String.fromCharCode(55296|i>>10,56320|1023&i)):n+=String.fromCharCode(a)}return n}function x(e,t,r){if((r=void 0===r?2147483647:r)<4)return 0;for(var n=t,i=n+r-4,a=0;a<e.length;++a){var s=e.charCodeAt(a);if(55296<=s&&s<=57343&&(s=65536+((1023&s)<<10)|1023&e.charCodeAt(++a)),f[t>>2]=s,i<(t+=4)+4)break}return f[t>>2]=0,t-n}function M(e){for(var t=0,r=0;r<e.length;++r){var n=e.charCodeAt(r);55296<=n&&n<=57343&&++r,t+=4}return t}var L,H,h,d,j,f,m,D,R;function I(e){L=e,l.HEAP8=H=new Int8Array(e),l.HEAP16=d=new Int16Array(e),l.HEAP32=f=new Int32Array(e),l.HEAPU8=h=new Uint8Array(e),l.HEAPU16=j=new Uint16Array(e),l.HEAPU32=m=new Uint32Array(e),l.HEAPF32=D=new Float32Array(e),l.HEAPF64=R=new Float64Array(e)}function N(e){for(;0<e.length;){var t,r=e.shift();"function"!=typeof r?"number"==typeof(t=r.func)?void 0===r.arg?l.dynCall_v(t):l.dynCall_vi(t,r.arg):t(void 0===r.arg?null:r.arg):r(l)}}w=new WebAssembly.Memory({initial:256,maximum:32768}),(L=w?w.buffer:L).byteLength,I(L),f[14584]=5301376;var B=[],q=[],J=[],Z=[];var $=Math.abs,G=Math.ceil,K=Math.floor,X=Math.min,Y=0,Q=null;function ee(e){y(e+=""),E=!0,e="abort("+e+"). Build with -s ASSERTIONS=1 for more info.";e=new WebAssembly.RuntimeError(e);throw n(e),e}l.preloadedImages={},l.preloadedAudios={};function te(e){return e=e,t="data:application/octet-stream;base64,",String.prototype.startsWith?e.startsWith(t):0===e.indexOf(t);var t}var i,a="cvizzu.wasm";function re(){try{if(_)return new Uint8Array(_);if(u)return u(a);throw"both async and sync fetching of the wasm failed"}catch(e){ee(e)}}function ne(e){switch(e){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+e)}}te(a)||(a=v+a),q.push({func:function(){Ee()}});var ie=void 0;function ae(e){for(var t="",r=e;h[r];)t+=ie[h[r++]];return t}var se={},oe={},ue=48,le=57;function ce(e,t){return e=function(e){if(void 0===e)return"_unknown";var t=(e=e.replace(/[^a-zA-Z0-9_]/g,"$")).charCodeAt(0);return ue<=t&&t<=le?"_"+e:e}(e),new Function("body","return function "+e+'() {\n    "use strict";    return body.apply(this, arguments);\n};\n')(t)}function he(e,t){var r=ce(t,function(e){this.name=t,this.message=e;e=new Error(e).stack;void 0!==e&&(this.stack=this.toString()+"\n"+e.replace(/^Error(:[^\n]*)?\n/,""))});return r.prototype=Object.create(e.prototype),(r.prototype.constructor=r).prototype.toString=function(){return void 0===this.message?this.name:this.name+": "+this.message},r}var de=void 0;function fe(e){throw new de(e)}function me(e,t,r){if(r=r||{},!("argPackAdvance"in t))throw new TypeError("registerType registeredInstance requires argPackAdvance");var n=t.name;if(e||fe('type "'+n+'" must have a positive integer typeid pointer'),oe.hasOwnProperty(e)){if(r.ignoreDuplicateRegistrations)return;fe("Cannot register type '"+n+"' twice")}oe[e]=t,se.hasOwnProperty(e)&&(r=se[e],delete se[e],r.forEach(function(e){e()}))}var ve=[],s=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function pe(){for(var e=0,t=5;t<s.length;++t)void 0!==s[t]&&++e;return e}function ye(){for(var e=5;e<s.length;++e)if(void 0!==s[e])return s[e];return null}function ge(e){return this.fromWireType(m[e>>2])}function _e(e){if(null===e)return"null";var t=typeof e;return"object"==t||"array"==t||"function"==t?e.toString():""+e}var we=function(){return performance.now()};var be={mappings:{},buffers:[null,[],[]],printChar:function(e,t){var r=be.buffers[e];0===t||10===t?((1===e?p:y)(T(r,0)),r.length=0):r.push(t)},varargs:void 0,get:function(){return be.varargs+=4,f[be.varargs-4>>2]},getStr:function(e){return c(e)},get64:function(e,t){return e}};for(var Ae=new Array(256),Ce=0;Ce<256;++Ce)Ae[Ce]=String.fromCharCode(Ce);ie=Ae,de=l.BindingError=he(Error,"BindingError"),l.InternalError=he(Error,"InternalError"),l.count_emval_handles=pe,l.get_first_emval=ye;var ze,Se={a:function(e){return Pe(e)},b:function(e,t,r){throw e},x:function(e,r,n,i,a){var s=ne(n);me(e,{name:r=ae(r),fromWireType:function(e){return!!e},toWireType:function(e,t){return t?i:a},argPackAdvance:8,readValueFromPointer:function(e){var t;if(1===n)t=H;else if(2===n)t=d;else{if(4!==n)throw new TypeError("Unknown boolean type size: "+r);t=f}return this.fromWireType(t[e>>s])},destructorFunction:null})},v:function(e,t){me(e,{name:t=ae(t),fromWireType:function(e){var t=s[e].value;return 4<(e=e)&&0==--s[e].refcount&&(s[e]=void 0,ve.push(e)),t},toWireType:function(e,t){var r=t;switch(r){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:var n=ve.length?ve.pop():s.length;return s[n]={refcount:1,value:r},n}},argPackAdvance:8,readValueFromPointer:ge,destructorFunction:null})},h:function(e,t,r){r=ne(r),me(e,{name:t=ae(t),fromWireType:function(e){return e},toWireType:function(e,t){if("number"!=typeof t&&"boolean"!=typeof t)throw new TypeError('Cannot convert "'+_e(t)+'" to '+this.name);return t},argPackAdvance:8,readValueFromPointer:function(e,t){switch(t){case 2:return function(e){return this.fromWireType(D[e>>2])};case 3:return function(e){return this.fromWireType(R[e>>3])};default:throw new TypeError("Unknown float type: "+e)}}(t,r),destructorFunction:null})},d:function(e,r,t,n,i){r=ae(r),-1===i&&(i=4294967295);var a,s=ne(t),o=function(e){return e},u=(0===n&&(a=32-8*t,o=function(e){return e<<a>>>a}),-1!=r.indexOf("unsigned"));me(e,{name:r,fromWireType:o,toWireType:function(e,t){if("number"!=typeof t&&"boolean"!=typeof t)throw new TypeError('Cannot convert "'+_e(t)+'" to '+this.name);if(t<n||i<t)throw new TypeError('Passing a number "'+_e(t)+'" from JS side to C/C++ side to an argument of type "'+r+'", which is outside the valid range ['+n+", "+i+"]!");return u?t>>>0:0|t},argPackAdvance:8,readValueFromPointer:function(e,t,r){switch(t){case 0:return r?function(e){return H[e]}:function(e){return h[e]};case 1:return r?function(e){return d[e>>1]}:function(e){return j[e>>1]};case 2:return r?function(e){return f[e>>2]}:function(e){return m[e>>2]};default:throw new TypeError("Unknown integer type: "+e)}}(r,s,0!==n),destructorFunction:null})},c:function(e,t,r){var n=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array][t];function i(e){var t=m,r=t[e>>=2],t=t[e+1];return new n(L,t,r)}me(e,{name:r=ae(r),fromWireType:i,argPackAdvance:8,readValueFromPointer:i},{ignoreDuplicateRegistrations:!0})},i:function(e,t){var u="std::string"===(t=ae(t));me(e,{name:t,fromWireType:function(e){var t=m[e>>2];if(u)for(var r=e+4,n=0;n<=t;++n){var i,a,s=e+4+n;n!=t&&0!=h[s]||(i=c(r,s-r),a=void 0===a?i:a+String.fromCharCode(0)+i,r=s+1)}else{for(var o=new Array(t),n=0;n<t;++n)o[n]=String.fromCharCode(h[e+4+n]);a=o.join("")}return Te(e),a},toWireType:function(e,i){var t="string"==typeof(i=i instanceof ArrayBuffer?new Uint8Array(i):i),r=(t||i instanceof Uint8Array||i instanceof Uint8ClampedArray||i instanceof Int8Array||fe("Cannot pass non-string to std::string"),(u&&t?function(){for(var e=i,t=0,r=0;r<e.length;++r){var n=e.charCodeAt(r);(n=55296<=n&&n<=57343?65536+((1023&n)<<10)|1023&e.charCodeAt(++r):n)<=127?++t:t+=n<=2047?2:n<=65535?3:4}return t}:function(){return i.length})()),n=Pe(4+r+1);if(m[n>>2]=r,u&&t)F(i,n+4,r+1);else if(t)for(var a=0;a<r;++a){var s=i.charCodeAt(a);255<s&&(Te(n),fe("String has UTF-16 code units that do not fit in 8 bits")),h[n+4+a]=s}else for(a=0;a<r;++a)h[n+4+a]=i[a];return null!==e&&e.push(Te,n),n},argPackAdvance:8,readValueFromPointer:ge,destructorFunction:function(e){Te(e)}})},f:function(e,u,i){var l,a,c,s,h;i=ae(i),2===u?(l=W,a=O,s=U,c=function(){return j},h=1):4===u&&(l=V,a=x,s=M,c=function(){return m},h=2),me(e,{name:i,fromWireType:function(e){for(var t=m[e>>2],r=c(),n=e+4,i=0;i<=t;++i){var a,s,o=e+4+i*u;i!=t&&0!=r[o>>h]||(a=l(n,o-n),s=void 0===s?a:s+String.fromCharCode(0)+a,n=o+u)}return Te(e),s},toWireType:function(e,t){"string"!=typeof t&&fe("Cannot pass non-string to C++ string type "+i);var r=s(t),n=Pe(4+r+u);return m[n>>2]=r>>h,a(t,n+4,r+u),null!==e&&e.push(Te,n),n},argPackAdvance:8,readValueFromPointer:ge,destructorFunction:function(e){Te(e)}})},y:function(e,t){me(e,{isVoid:!0,name:t=ae(t),argPackAdvance:0,fromWireType:function(){},toWireType:function(e,t){}})},e:function(){ee()},L:function(e,t,r,n,i,a){l.render.dc().bezierCurveTo(e,t,r,n,i,a)},M:function(e,t){var r=l.render.dc();l.render.startPolygonNotification()?r.moveTo(e,t):r.lineTo(e,t)},T:function(){},N:function(){l.render.dc().beginPath()},I:function(e,t,r){var n=l.render.dc();n.beginPath(),n.arc(e,t,r,0,6.28318530718),n.fill(),l.render.noneZeroLineWidth()&&n.stroke()},E:function(e,t,r,n,i,a){},P:function(){let e=l.render.dc();e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0,e.shadowColor="rgba(0, 0, 0, 0)"},K:function(){var e=l.render.dc();e.closePath(),e.fill(),l.render.noneZeroLineWidth()&&e.stroke(),l.render.endPolygonNotification()},C:function(){l.render.frameBegin()},k:function(){l.render.frameEnd()},H:function(e,t,r,n){var i=l.render.dc();i.beginPath(),i.moveTo(e,t),i.lineTo(r,n),l.render.noneZeroLineWidth()&&i.stroke()},J:function(e,t,r,n){var i=l.render.dc();i.beginPath(),i.rect(e,t,r,n),i.fill(),l.render.noneZeroLineWidth()&&i.stroke()},z:function(){l.render.dc().restore()},A:function(){l.render.dc().save()},X:function(e,t,r,n){l.render.dc().fillStyle="rgba("+255*e+","+255*t+","+255*r+","+n+")"},F:function(e,t,r,n,i,a){for(var s=l.render.dc(),o=s.createLinearGradient(e,t,r,n),u=0;u<40*i;u+=40)o.addColorStop(z(a+u,"double"),"rgba("+255*z(a+u+8,"double")+","+255*z(a+u+16,"double")+","+255*z(a+u+24,"double")+","+z(a+u+32,"double")+")");s.fillStyle=o},l:function(e,t,r){var n=l.render.dc();n.beginPath(),n.arc(e,t,r,0,6.28318530718),n.clip()},Y:function(){var e=l.render.dc();e.closePath(),e.clip(),l.render.endPolygonNotification()},m:function(e,t,r,n){var i=l.render.dc();i.beginPath(),i.rect(e,t,r,n),i.clip()},S:function(e){let t=l.render.dc();t.shadowBlur=e},R:function(e,t,r,n){let i=l.render.dc();i.shadowColor="rgba("+255*e+","+255*t+","+255*r+","+n+")"},Q:function(e,t){let r=l.render.dc();r.shadowOffsetX=e,r.shadowOffsetY=t},U:function(e){l.render.dc().font=c(e)},W:function(e,t,r,n){l.render.dc().strokeStyle="rgba("+255*e+","+255*t+","+255*r+","+n+")"},V:function(e){l.render.dc().lineWidth=e,l.render.lineWidthNotification(e)},G:function(e,t,r,n,i){var a=l.render.dc();a.textAlign="left",a.textBaseline="top",e+=r<0?-r:0,t+=n<0?-n:0,a.fillText(c(i),e,t)},n:function(e,t,r){var e=(n=l.render.dc()).measureText(c(e)).width,n=(n=n.measureText("Op")).actualBoundingBoxAscent+n.actualBoundingBoxDescent;C(t,e,"double"),C(r,n,"double")},B:function(e,t,r,n){var i=l.render.dc();i.translate(e,t),i.rotate(n),i.scale(r,r)},u:function(e,t){var r;if(0===e)r=Date.now();else{if(1!==e&&4!==e)return-1;r=we()}return f[t>>2]=r/1e3|0,f[t+4>>2]=r%1e3*1e3*1e3|0,0},r:function(e,t,r){h.copyWithin(e,t,t+r)},s:function(e){var t=h.length,r=2147483648;if(r<(e>>>=0))return!1;for(var n,i=1;i<=4;i*=2){var a=t*(1+.2/i),a=Math.min(a,e+100663296);if(function(e){try{return w.grow(e-L.byteLength+65535>>>16),I(w.buffer),1}catch(e){}}(Math.min(r,(0<(a=Math.max(16777216,e,a))%(n=65536)&&(a+=n-a%n),a))))return!0}return!1},w:function(e,t){l.events.invoke(e,t)},t:function(e){return 0},p:function(e,t,r,n,i){},g:function(e,t,r,n){for(var i=0,a=0;a<r;a++){for(var s=f[t+8*a>>2],o=f[t+(8*a+4)>>2],u=0;u<o;u++)be.printChar(e,h[s+u]);i+=o}return f[n>>2]=i,0},D:function(e){console.log((new Date).toISOString()+": "+c(e))},memory:w,o:function(e){window.open(c(e),"_blank")},O:function(e){l.removeFunction(e)},j:function(e){return 0<=(e=+e)?+K(e+.5):+G(e-.5)},q:function(e){l.render.canvas().style.cursor=c(e)},table:S},Ee=(function(){var t={a:Se};function r(e,t){var e=e.exports;l.asm=e,0==--Y&&Q&&(e=Q,Q=null,e())}function n(e){r(e.instance)}function i(e){return("function"==typeof fetch?fetch(a,{credentials:"same-origin"}).then(function(e){if(!e.ok)throw"failed to load wasm binary file at '"+a+"'";return e.arrayBuffer()}).catch(re):new Promise(function(e,t){e(re())})).then(function(e){return WebAssembly.instantiate(e,t)}).then(e,function(e){y("failed to asynchronously prepare wasm: "+e),ee(e)})}if(Y++,l.instantiateWasm)try{return l.instantiateWasm(t,r)}catch(e){return y("Module.instantiateWasm callback failed with error: "+e)}(function(){if("function"!=typeof WebAssembly.instantiateStreaming||te(a)||"function"!=typeof fetch)return i(n);fetch(a,{credentials:"same-origin"}).then(function(e){return WebAssembly.instantiateStreaming(e,t).then(n,function(e){return y("wasm streaming compile failed: "+e),y("falling back to ArrayBuffer instantiation"),i(n)})})})()}(),l.___wasm_call_ctors=function(){return(Ee=l.___wasm_call_ctors=l.asm.Z).apply(null,arguments)}),Pe=(l._vizzu_errorMessage=function(){return(l._vizzu_errorMessage=l.asm._).apply(null,arguments)},l._vizzu_version=function(){return(l._vizzu_version=l.asm.$).apply(null,arguments)},l._vizzu_setLogging=function(){return(l._vizzu_setLogging=l.asm.aa).apply(null,arguments)},l._vizzu_init=function(){return(l._vizzu_init=l.asm.ba).apply(null,arguments)},l._vizzu_keyPress=function(){return(l._vizzu_keyPress=l.asm.ca).apply(null,arguments)},l._vizzu_mouseMove=function(){return(l._vizzu_mouseMove=l.asm.da).apply(null,arguments)},l._vizzu_mouseDown=function(){return(l._vizzu_mouseDown=l.asm.ea).apply(null,arguments)},l._vizzu_mouseUp=function(){return(l._vizzu_mouseUp=l.asm.fa).apply(null,arguments)},l._vizzu_mouseLeave=function(){return(l._vizzu_mouseLeave=l.asm.ga).apply(null,arguments)},l._vizzu_poll=function(){return(l._vizzu_poll=l.asm.ha).apply(null,arguments)},l._vizzu_update=function(){return(l._vizzu_update=l.asm.ia).apply(null,arguments)},l._style_getList=function(){return(l._style_getList=l.asm.ja).apply(null,arguments)},l._style_setValue=function(){return(l._style_setValue=l.asm.ka).apply(null,arguments)},l._style_getValue=function(){return(l._style_getValue=l.asm.la).apply(null,arguments)},l._chart_store=function(){return(l._chart_store=l.asm.ma).apply(null,arguments)},l._chart_restore=function(){return(l._chart_restore=l.asm.na).apply(null,arguments)},l._chart_free=function(){return(l._chart_free=l.asm.oa).apply(null,arguments)},l._chart_getList=function(){return(l._chart_getList=l.asm.pa).apply(null,arguments)},l._chart_getValue=function(){return(l._chart_getValue=l.asm.qa).apply(null,arguments)},l._chart_setValue=function(){return(l._chart_setValue=l.asm.ra).apply(null,arguments)},l._chart_setFilter=function(){return(l._chart_setFilter=l.asm.sa).apply(null,arguments)},l._record_getValue=function(){return(l._record_getValue=l.asm.ta).apply(null,arguments)},l._data_addDimension=function(){return(l._data_addDimension=l.asm.ua).apply(null,arguments)},l._data_addMeasure=function(){return(l._data_addMeasure=l.asm.va).apply(null,arguments)},l._data_addRecord=function(){return(l._data_addRecord=l.asm.wa).apply(null,arguments)},l._addEventListener=function(){return(l._addEventListener=l.asm.xa).apply(null,arguments)},l._removeEventListener=function(){return(l._removeEventListener=l.asm.ya).apply(null,arguments)},l._event_preventDefault=function(){return(l._event_preventDefault=l.asm.za).apply(null,arguments)},l._chart_animate=function(){return(l._chart_animate=l.asm.Aa).apply(null,arguments)},l._anim_control=function(){return(l._anim_control=l.asm.Ba).apply(null,arguments)},l._anim_setValue=function(){return(l._anim_setValue=l.asm.Ca).apply(null,arguments)},l.___getTypeName=function(){return(l.___getTypeName=l.asm.Da).apply(null,arguments)},l.___embind_register_native_and_builtin_types=function(){return(l.___embind_register_native_and_builtin_types=l.asm.Ea).apply(null,arguments)},l._malloc=function(){return(Pe=l._malloc=l.asm.Fa).apply(null,arguments)}),Te=l._free=function(){return(Te=l._free=l.asm.Ga).apply(null,arguments)};l.dynCall_vi=function(){return(l.dynCall_vi=l.asm.Ha).apply(null,arguments)},l.dynCall_v=function(){return(l.dynCall_v=l.asm.Ia).apply(null,arguments)};function Fe(e){function t(){ze||(ze=!0,l.calledRun=!0,E||(N(q),N(J),r(l),N(Z)))}0<Y||(N(B),0<Y||t())}return l.setValue=C,l.getValue=z,l.UTF8ToString=c,l.stringToUTF8=F,l.addFunction=A,l.removeFunction=function(e){e=e,g.delete(S.get(e)),b.push(e)},Q=function e(){ze||Fe(),ze||(Q=e)},(l.run=Fe)(),t.ready}}();const isAccessibleStylesheet=e=>{try{return e.cssRules,!0}catch(e){return!1}},getCSSCustomProps=(r="")=>[...document.styleSheets].filter(isAccessibleStylesheet).reduce((e,t)=>e.concat([...t.cssRules].filter(e=>1===e.type).reduce((e,t)=>{t=[...t.style].filter(e=>0===e.trim().indexOf("--"+r)).map(e=>e.trim());return[...e,...t]},[])),[]),getCSSCustomPropsForElement=(e,t="")=>{const r=getCSSCustomProps(t),n=getComputedStyle(e);return r.map(e=>[e,n.getPropertyValue(e).trim()]).filter(e=>""!==e[1])},propSet=(e,n,i,a)=>(n.reduce((e,t,r)=>(r===n.length-1?!a&&e[t]||(e[t]=i):e[t]||(e[t]={}),e[t]),e),e),propsToObject=(e,t,i="",a=!1)=>t=e.reduce((e,[t,r])=>{const n=t.replace("--"+(i?i+"-":""),"");t=n.split("-");return propSet(e,t,r,a),e},t=t||{});class Vizzu{constructor(e,t){if(this.container=e,this.container instanceof HTMLElement||(this.container=document.getElementById(e)),!this.container)throw new Error(`Cannot find container ${this.container} to render Vizzu!`);this._propPrefix="vizzu",this.started=!1,this._resolveAnimate=null,this.initializing=new AnimControl(e=>{this._resolveAnimate=e},this),this.anim=this.initializing,VizzuModule().then(e=>{this._resolveAnimate&&this._resolveAnimate(this.init(e))}),t&&this.animate(t,0),this.snapshotRegistry=new FinalizationRegistry(e=>{this.call(this.module._chart_free)(e)})}call(e){return(...t)=>{try{return e(...t)}catch(e){t=parseInt(e,10),t=this.module._vizzu_errorMessage(t),t=this.module.UTF8ToString(t);throw new Error("error: "+t)}}}iterateObject(r,n,i=""){r&&Object.keys(r).forEach(e=>{var t=i+(0===i.length?"":".")+e;null!==r[e]&&"object"==typeof r[e]?this.iterateObject(r[e],n,t):this.setValue(t,r[e],n)})}setNestedProp(r,e,n){let i=e.split(".");i.forEach((e,t)=>{t<i.length-1?(r[e]=r[e]||{},r=r[e]):r[e]=n.startsWith("[")?JSON.parse(n):n})}setValue(e,t,r){if(e!==""+e)throw new Error("first parameter should be string");e=this.toCString(e),t=this.toCString(String(t).toString());try{r(e,t)}finally{this.module._free(t),this.module._free(e)}}setStyle(e){this.iterateObject(e,(e,t)=>{this.call(this.module._style_setValue)(e,t)})}cloneObject(e,t){var r,e=this.call(e)(),e=this.fromCString(e),n={};for(r of JSON.parse(e)){var i=this.toCString(r);try{var a=this.call(t)(i),s=this.fromCString(a);this.setNestedProp(n,r,s)}finally{this.module._free(i)}}return Object.freeze(n),n}get config(){return this.cloneObject(this.module._chart_getList,this.module._chart_getValue)}get styles(){return this.cloneObject(this.module._style_getList,this.module._style_getValue)}setConfig(r){if(null!==r&&"object"==typeof r&&Object.keys(r).forEach(e=>{["color","lightness","size","label","x","y","noop"].includes(e)&&(r.channels=r.channels||{},r.channels[e]=r[e],delete r[e])}),r?.channels){let t=r.channels;Object.keys(t).forEach(e=>{"string"==typeof t[e]&&(t[e]=[t[e]]),null!==t[e]&&!Array.isArray(t[e])||(t[e]={set:t[e]}),"string"==typeof t[e].attach&&(t[e].attach=[t[e].attach]),"string"==typeof t[e].detach&&(t[e].detach=[t[e].detach]),"string"==typeof t[e].set&&(t[e].set=[t[e].set]),Array.isArray(t[e].set)&&0===t[e].set.length&&(t[e].set=null)})}this.iterateObject(r,(e,t)=>{this.call(this.module._chart_setValue)(e,t)})}on(e,t){this.events.add(e,t)}off(e,t){this.events.remove(e,t)}store(){var e=this.call(this.module._chart_store)(),t={id:e};return this.snapshotRegistry.register(t,e),t}restore(e){this.call(this.module._chart_restore)(e.id)}feature(e,t){"tooltip"===e&&this.tooltip.enable(t)}animate(e,t){return this.anim=this.anim.then(()=>this.animStep(e,t)),this.anim}animStep(t,e){if(t){let e=Object.assign({},t);var r;e.id?this.restore(e):(e.data||void 0!==e.style||e.config||(e={config:e}),this.data.set(e.data),null===e.style&&(e.style={"":null}),t=JSON.parse(JSON.stringify(e.style||{})),r=getCSSCustomPropsForElement(this.container,this._propPrefix),this.setStyle(propsToObject(r,t,this._propPrefix)),this.setConfig(Object.assign({},e.config)))}return this.setAnimation(e),new AnimControl(e=>{let t=this.module.addFunction(()=>{e(this),this.module.removeFunction(t)},"v");this.call(this.module._chart_animate)(t)},this)}setAnimation(e){if(void 0!==e){if(null===e?e={duration:0}:"string"!=typeof e&&"number"!=typeof e||(e={duration:e}),"object"!=typeof e)throw new Error("invalid animation option");e=Object.assign({},e),this.iterateObject(e,(e,t)=>{this.call(this.module._anim_setValue)(e,t)})}}get animation(){return this.anim}version(){var e=this.module._vizzu_version();return this.module.UTF8ToString(e)}start(){this.started||(this.call(this.module._vizzu_poll)(),this.render.updateFrame(!1),setInterval(()=>{this.call(this.module._vizzu_poll)()},10),setInterval(()=>{this.render.updateFrame(!1)},25),this.started=!0)}getMousePos(e){var t=this.render.clientRect();return[e.clientX-t.left,e.clientY-t.top]}toCString(e){var t=4*e.length+1,r=this.module._malloc(t);return this.module.stringToUTF8(e,r,t),r}fromCString(e){return this.module.UTF8ToString(e)}init(e){this.module=e;e=this.createCanvas();return this.render=new Render,this.module.render=this.render,this.data=new Data(this),this.events=new Events(this),this.module.events=this.events,this.tooltip=new Tooltip(this),this.render.init(this.call(this.module._vizzu_update),e,!1),this.call(this.module._vizzu_init)(),this.call(this.module._vizzu_setLogging)(!1),this.setupDOMEventHandlers(e),this.start(),this}createCanvas(){let e=null,t=this.container;if(t instanceof HTMLCanvasElement?e=t:(e=document.createElement("CANVAS"),e.style.width="100%",e.style.height="100%",t.appendChild(e)),!(e instanceof HTMLCanvasElement))throw new Error("Error initializing <canvas> for Vizzu!");return e}setupDOMEventHandlers(e){this.resizeObserver=new ResizeObserver(()=>{this.render.updateFrame(!0)}),this.resizeObserver.observe(e),window.addEventListener("resize",()=>{this.render.updateFrame(!0)}),e.addEventListener("mousemove",e=>{e=this.getMousePos(e);this.call(this.module._vizzu_mouseMove)(e[0],e[1])}),e.addEventListener("mouseup",e=>{e=this.getMousePos(e);this.call(this.module._vizzu_mouseUp)(e[0],e[1])}),e.addEventListener("mousedown",e=>{e=this.getMousePos(e);this.call(this.module._vizzu_mouseDown)(e[0],e[1])}),e.addEventListener("mouseout",()=>{this.call(this.module._vizzu_mouseLeave)()}),document.addEventListener("keydown",t=>{let r=t.keyCode<=255?t.keyCode:0;var n=[33,34,36,35,37,39,38,40,27,9,13,46];for(let e=0;e<n.length;e++)t.key===n[e]&&(r=256+e);0!==r&&this.call(this.module._vizzu_keyPress)(r,t.ctrlKey,t.altKey,t.shiftKey)})}}export default Vizzu;